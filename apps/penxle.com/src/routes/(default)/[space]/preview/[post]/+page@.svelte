<script lang="ts">
  import clsx from 'clsx';
  import Wordmark from '$assets/icons/wordmark.svg?component';
  import { graphql } from '$glitch';
  import { Logo } from '$lib/components/branding';
  import Footer from '../../../Footer.svelte';
  import Post from '../../Post.svelte';

  let mode: 'desktop' | 'mobile' = 'desktop';

  $: query = graphql(`
    query SpacePreviewPostPage_Query($permalink: String!) {
      post(permalink: $permalink) {
        id

        draftRevision {
          id
          ...Post_postRevision
        }
      }

      ...Post_query
    }
  `);
</script>

<header class="relative sticky top-0 z-10 border-b border-secondary bg-white px-4 py-2 sm:px-7.5 h-15.25 flex center">
  <nav class="w-full max-w-300">
    <section class="flex items-center justify-between relative">
      <div class="mr-3.5 flex items-center gap-2 sm:mr-4 transition w-fit absolute left-0">
        <Logo class="<sm:square-7.5 sm:square-6" />
        <Wordmark class="<sm:hidden h-5.25" />
      </div>

      <div class="grow flex center">
        <div
          class={clsx(
            "bg-surface-primary rounded-2.5 h-10 w-fit grid relative grid-cols-2 before:(content-[''] absolute w-50% h-100% left-0 bg-cardprimary border border-secondary rounded-2.5 transition-all)",
            mode === 'mobile' && 'before:left-50%',
          )}
        >
          <button
            class={clsx(
              'h-10 py-2 px-4 flex items-center gap-2 z-1',
              mode === 'desktop' &&
                'first:(text-icon-primary transition-color) last:(text-icon-secondary transition-color)',
              mode === 'mobile' &&
                'first:(text-icon-secondary transition-color) last:(text-icon-primary transition-color)',
            )}
            type="button"
            on:click={() => {
              mode = 'desktop';
            }}
          >
            <i class="i-lc-monitor square-5" />
          </button>
          <button
            class={clsx(
              'h-10 py-2 px-4 flex items-center gap-2 z-1',
              mode === 'desktop' && 'first:(text-icon-primary transition) last:(text-icon-secondary transition)',
              mode === 'mobile' && 'first:(text-icon-secondary transition) last:(text-icon-primary transition)',
            )}
            type="button"
            on:click={() => {
              mode = 'mobile';
            }}
          >
            <i class="i-lc-smartphone square-5" />
          </button>
        </div>
      </div>
    </section>
  </nav>
</header>

<main class="flex grow items-start justify-center m-auto w-full bg-primary">
  <Post
    class={clsx(
      mode === 'mobile' && 'max-w-100 py-17!',
      mode === 'desktop' && 'max-w-262 py-7.5! border-l border-r border-secondary',
    )}
    $postRevision={$query.post.draftRevision}
    {$query}
    preview
  />
</main>

<Footer />
